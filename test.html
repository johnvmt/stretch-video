<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>
	<video id="myVideo" src="video/tc30.mp4" controls width="720"></video>
	<script type="text/javascript">
		console.log(secondsToSmpte(smpteToSeconds('21:24:20:15', 30), 30));

		function smpteToSeconds(timecode, framerate) {
			var separators = [';', ':'];
			var timecodeParts = timecode.split(new RegExp(separators.join('|'), 'g'));

			// for each part of timecode, how to modify it to return frames
			var timecodeFrameModifiers = [
				function(hours) { return hours * 3600 * framerate}, // hours
				function(minutes) { return minutes * 60 * framerate}, // minutes
				function(seconds) { return seconds * framerate}, // seconds
				function(frames) { return frames; } // frames
			];

			var frames = 0;
			for(var partKey = timecodeParts.length - 1; partKey >= 0; partKey--) {
				frames += timecodeFrameModifiers[partKey](Number(timecodeParts[partKey]));
			}
			return frames / framerate;
		}

		function secondsToSmpte(seconds, framerate) {

			var frames = seconds * framerate;

			var separators = [':', ':', ':', ':']; // TODO drop frame modifications

			var frameTimecodeModifiers = [
				function(totalFrames) { return Math.floor(totalFrames / (framerate * 3600)) }, // hours
				function(totalFrames) { return Math.floor(totalFrames / (framerate * 60)) % 60 }, // minutes
				function(totalFrames) { return Math.floor(totalFrames / framerate) % framerate }, // seconds
				function(totalFrames) { return Math.floor(totalFrames % framerate); } // frames
			];

			var timecode = '';
			for(var ftIndex = 0; ftIndex < frameTimecodeModifiers.length; ftIndex++) {
				if(ftIndex > 0)
					timecode += separators[ftIndex - 1];
				timecode += String("00" + frameTimecodeModifiers[ftIndex](frames)).slice(-2);

			}
			return timecode;
		}

		var vid = document.getElementById("myVideo");

		var stopPoint = 4.48;
		var tolerance = 0.5;
		var inloop = false;

		vid.addEventListener("timeupdate", function() {

			var vidTime = vid.currentTime;
			if(vidTime + tolerance > stopPoint && !inloop) {
				console.log("INLOOP");
				inloop = true;

				var targetTime = (stopPoint - vidTime) * 1000;

				var loopStart = new Date();
				var loopStartTime = loopStart.getTime();

				timeoutStart();

				function afterSetTimeout() {
					loopEnd = new Date();
					if(loopEnd.getTime() - loopStartTime >= targetTime - 4) {
						vid.pause();
						console.log(vid.currentTime);
					}
					else
						timeoutStart();

				}

				function timeoutStart() {
					setTimeout(afterSetTimeout, 4);
				}


				//vid.pause();


			}

		});

		/*
		vid.addEventListener("play", function() {

			var currentTime = vid.currentTime;


			console.log("PLAY", vid.currentTime);
		});


		vid.addEventListener("pause", function() {
			vid.currentTime = 10;
			console.log("PAUSE", vid.currentTime);
		});

		 */
		vid.play();




	</script>
</body>
</html>